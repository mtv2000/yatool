
## Конфигурация системы сборки

### Основные настройки

Основные параметры системы сборки описаны в файле build/yamake.core.conf, а также в .conf-файлах в директории build/conf. Язык конфигурации представляет собой декларативный DSL, включающий:

- Язык описания правил.
- Язык описания макросов и модулей.
- Язык параметризованных подстановок шаблонов.

### Содержимое файлов конфигурации

Файлы конфигурации могут включать:

1. Установку значений переменных: переменные используются в правилах конфигурирования и сборочных командах.
2. Правила установки значений переменных: на основе значений других переменных с использованием синтаксиса when/elsewhen/otherwise.
3. Описание модулей и мультимодулей: доступных в ya.make.
4. Описание макросов: как внутренних для конфигурации, так и публичных для файлов ya.make.

Дополнительно конфигурация системы сборки включает:

- Плагины в директории build/plugins: для макросов, которые нельзя описать на языке конфигурации.
- Правила в директории build/rules: для ограничения зависимостей.
- Правила резолвинга хедеров в директории build/sysincl.
- Скрипты в директории build/scripts: для реализации логики сборочных команд.
- Описание тулчейнов в файлах ya.make.

## Использование конфигурации

### Процесс обработки

1. Чтение конфигурации: Зачитываются и устанавливаются глобальные переменные.
2. Формирование конфигурации сборки: Конфигурация частично формируется динамически скриптом build/&gt;yamake_conf.py.
3. Обработка переменных и триггеров: Конфигурационные переменные принимают свои начальные глобальные значения.
4. Чтение ya.make файла: Устанавливаются локальные переменные, которые могут через триггеры повлиять на значения других переменных.
5. Исполнение макросов: Макросы исполняются в порядке своих приоритетов и формируют команды для построения.
6. Обработка зависимостей: Рекурсивно обрабатываются зависимости между модулями.
7. Формирование команд: Команды помещаются в граф зависимостей и исполняются по мере готовности входных файлов.

### Источники макросов

- Встроенные макросы: обеспечивают базовые функции и описаны в коде ядра системы сборки.
- Конфигурируемые макросы, модули и мультимодули: описаны в файлах конфигурации build/&gt;yamake.core.conf и в директории build/conf.

## Описание макросов и модулей

### Макросы

Макросы делятся на две основные группы:
1. Макросы, задающие свойства: Формируют переменные и устанавливают зависимости.
2. Макросы, описывающие команды: Описывают команды для исполнения в процессе сборки.

### Модули

Модуль — это макрос, описывающий команду своей сборки и ряд дополнительных свойств:
- Формирование имени модуля.
- Автоматические входы команд.
- Связывание с другими модулями.
- Допустимые макросы и их полиморфизм.
- Условные правила поведения модуля.

### Мультимодули

Мультимодули описываются как совокупность модулей с уникальными тэгами, которые определяют зависимость вариантов друг от друга.

## Плагины

Система сборки ya.make поддерживает расширение с использованием плагинов на Python и C++:
- Python-плагины: размещены в build/plugins и интерпретируются ядром системы сборки в момент исполнения.
- C+±плагины: влинкованы в ядро системы сборки и требуют пересборки для локальной разработки.
