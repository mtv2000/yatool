## Настройка и расширение системы сборки

Файл `ymake.core.conf` является основным конфигурационным файлом системы сборки `ymake` и играет ключевую роль в управлении процессом сборки проектов. 

Он описывает макросы, модули, мультимодули, глобальные переменные, системные заголовки и другие аспекты конфигурации сборки. 

Используя декларативный язык `DSL` (Domain-Specific Language), файл позволяет гибко настраивать правила для различных платформ, устанавливать шаблоны сборочных команд, определять их свойства и зависимости, а также управлять входами и результатами команд, связывая их в граф.

Конфигурационный файл `ymake.core.conf` предоставляет следующие возможности:
- Устанавливать правила настройки переменных для разных платформ и параметров.
- Описывать макросы, их параметры и поведение.
- Определять шаблоны сборочных команд с их дополнительными свойствами, такими как отображаемое имя или требуемые ресурсы.
- Указывать входные и выходные данные для связывания команд в граф.
- Применять макросы в зависимости от расширений файлов.
- Задавать свойства модулей и связывать их с командами и между собой.
- Устанавливать правила для модулей: их свойства и команды зависят от платформы и параметров.
- Определять варианты мультимодулей и их зависимости.

### Правила настройки переменных
При описании модуля некоторые переменные можно сделать глобальными. Для этого используется свойство `.GLOBAL` у модуля. Для обращения к глобальной переменной нужно добавить суффикс `_GLOBAL` к её имени.

Пример:
```
module MY_MOD {
    .CMD=builder --list $MY_VAR_GLOBAL --extra $ANOTHER_VAR_GLOBAL
    .GLOBAL=MY_VAR ANOTHER_VAR
    ...

    SET(MY_VAR_GLOBAL $MODDIR)
    SET(ANOTHER_VAR_GLOBAL VERBOSE)
}
```
Во время конфигурации модуля глобальные переменные ведут себя как локальные. Можно получать только те значения, которые установлены в текущем модуле.  
Однако, на этапе выполнения (рендера) глобальная переменная собирает все значения, установленные во всех модулях, от которых зависит текущий модуль. Значения собираются в обратном порядке обхода графа зависимостей: от корня к листьям.  
Т.е. значения из корневых узлов будут в конце списка, а из листовых - в начале.

**Пример зависимости:**
```

  ┌─────► lib-mid1──────┐
  │                     ▼
main                  lib-leaf
  │                     ▲
  └─────► lib-mid2──────┘

```
Для конечного модуля `main` сборочные команды будут выглядеть так:

```bash
# lib-leaf
builder --list lib-leaf --extra VERBOSE

# lib-mid1
builder --list lib-leaf lib-mid1 --extra VERBOSE VERBOSE

# lib-mid2
builder --list lib-leaf lib-mid2 --extra VERBOSE VERBOSE

# main
builder --list lib-leaf lib-mid1 lib-mid2 main --extra VERBOSE VERBOSE VERBOSE VERBOSE

```
Разворачивание глобальных переменных происходит на этапе рендера. Это означает, что модификаторы `input` и `output` на глобальных переменных не добавят дополнительные зависимые ребра в граф. Однако, можно использовать фильтры и форматеры (например, `suf`, `pre`, `join`, `ext`) для обработки значений.

Пример использования:
```bash
${pre=arc/;suf=/bin:MY_VAR_GLOBAL}
```

В проекте также существуют предопределенные глобальные переменные, такие как `PEERS`.

Для глобальных ресурсов действуют особые правила. Если глобальный ресурс определён в нескольких модулях, все определения должны быть идентичны.  
При несовпадении значений это приводит к ошибке конфигурации.

Пример глобального ресурса:
```
{resource:RESOURCES_URIS_GLOBAL}
```

В рендере глобального ресурса используется только одно значение, последующие объявления игнорируются.

Глобальные переменные и ресурсы облегчают распространение параметров и настроек между модулями, что упрощает управление сложными зависимостями и конфигурациями проекта.
