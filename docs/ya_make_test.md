# Опции тестирования
## Запуск тестов
* Опция `-t` используется в командной строке с целью запуска тестов в системах сборки. Эта опция может иметь несколько уточняющих модификаторов, которые позволяют более гранулярно контролировать, какие именно тесты будут запущены. В зависимости от системы сборки или тестовой инфраструктуры, семантика и реализация этих опций может немного отличаться, но базовая концепция остаётся схожей.

 `-t` — Запустить SMALL тесты
Опция `-t` без дополнительных модификаторов указывает системе выполнить запуск тестов, классифицированных как SMALL. 

SMALL тесты обычно включают в себя легковесные тесты, такие как unit-тесты, которые быстро выполняются и не требуют сложной конфигурации окружения или внешних зависимостей. Запуск исключительно SMALL тестов позволяет быстро получить обратную связь о качестве кода без значительного увеличения времени сборки или тестирования и выполняются не более 1 минуты

`-tt` — Запустить SMALL и MEDIUM тесты
Использование двойного модификатора `-tt` расширяет диапазон запускаемых тестов, добавляя к SMALL тестам ещё и те, что классифицированы как MEDIUM. 

MEDIUM тесты могут включать в себя более тяжёлые или затратные по времени проверки по сравнению с SMALL, например, интеграционные тесты и end-to-end тесты. Такая комбинация позволяет выполнить более широкое тестирование без значительного увеличения времени и ресурсов, хоть и с меньшей скоростью обратной связи, чем при запуске только SMALL тестов. Обычно выполняются не более 10 минут.

 `-ttt` — Запустить SMALL, MEDIUM и LARGE тесты
При добавлении третьего модификатора `-ttt` система будет запускать тесты всех размеров: SMALL, MEDIUM и LARGE.

LARGE тесты — это самые затратные по времени и ресурсам тесты. Их выполнение может занимать значительное время, обычно не более 1 часа, но позволяет максимально полно убедиться в качестве и стабильности продукта.

Строгого соответствия между размером тестов (SMALL, MEDIUM, LARGE) и типом тестов (unit, интеграционные, end to end) нет. В первую очередь нужно ориентироваться на максимальное время исполнения каждого теста.

* Опция `-A` или `--run-all-tests` используется для запуска всех доступных тестов в контексте заданной среды сборки или тестирования. Этот флаг тоже, что и `-ttt`

Основное предназначение этой опции — обеспечить комплексную проверку всего проекта путем выполнения всех заранее подготовленных и доступных тестов.
 
* Опция `-L` или `--list-tests` предоставляет функциональность для вывода списка доступных тестов  без их фактического запуска.

Инструмент полезен для получения обзора тестового покрытия проекта, а также для выборочного запуска конкретных тестов при необходимости.

Опция поддерживает выбор размера тестов, а также все параметры фильтрации.

`ya make -AL --regular-tests devtools/examples/tutorials/python`

После выполнения этой команды пользователь получит на стандартный вывод список тестов, доступных для запуска. 

* Опция `--test-threads=TEST_THREADS` используется в контексте автоматизированного тестирования программного обеспечения для управления количеством потоков, которые могут выполнять тесты параллельно.

Значение `TEST_THREADS`, указываемое в качестве параметра опции, определяет максимальное количество тестов, которые будут запущены одновременно. 

На серверах непрерывной интеграции или локальных машинах с ограниченными аппаратными ресурсами может быть целесообразно ограничить число параллельно выполняемых тестов, чтобы избежать излишней нагрузки на систему и потому по умолчанию в параллель запускается не больше 2х тестов.

* Опция `--fail-fast`  указывает инструменту тестирования прервать процесс выполнения тестов сразу же после обнаружения первого провального (непройденного) теста.

Такой подход используется для экономии времени при разработке и диагностике ошибок. Позволяет разработчикам быстро получить информацию о проблемах в коде, не дожидаясь завершения полного цикла тестирования.

`ya make -A --fail-fast devtools/examples/tutorials/python`

При запуске команда останавливает процесс после первого же провального теста и возвращает статус ошибки. Это значит, что оставшиеся тесты не будут запущены, и команда прекращает свою работу, предоставляя пользователю информацию о проваленном тесте.

* Опция `--add-peerdirs-tests=PEERDIRS_TEST_TYPE` представляет собой настройку в инструментах сборки и тестирования, которая определяет, какие тесты из зависимостей (обозначаются через механизм PEERDIR) следует включать в текущую сессию тестирования. Опция позволяет настроить процесс тестирования, выбирая, в какой степени тесты зависимостей должны учитываться при запуске. 

 Параметры `PEERDIRS_TEST_TYPE`:
 - `none`: Тесты из зависимостей не включаются автоматически. Единственные тесты, которые будут запущены, — это те, что явно указаны в текущей цели тестирования. Это поведение по умолчанию, исходя из предположения, что разработчик хочет запустить только тесты, непосредственно связанные с текущим компонентом или изменениями.
 - `gen`: Включаются только тесты, сгенерированные автоматически (например, для проверки API или контрактов интерфейсов) из зависимостей, указанных через `PEERDIR`. Применяется для проверки того, что изменения в текущем компоненте не нарушили ожидаемые правила использования взаимодействующих с ним компонентов.
 - `all`: Включаются все доступные тесты из зависимостей, создающее самое широкое покрытие. Режим полезен при проведении комплексного тестирования перед важными релизами или для проверки интеграции на уровне всего проекта.

* Опция `--split-factor=TESTING_SPLIT_FACTOR` является конфигурационным параметром,  позволяет управлять степенью параллелизма тестов, переопределяя значение параметра `SPLIT_FACTOR`.
* 
`SPLIT_FACTOR` определяет, как тесты могут быть разбиты на более мелкие группы (или “чанки”) для параллельного выполнения.

`SPLIT_FACTOR` является числовым параметром, который указывает величину, на которую могут быть разделены тесты для исполнения в параллельных потоках или процессах. 

Например, если для набора из 100 тестов установлен `SPLIT_FACTOR` равный 10 (значение по умолчанию), эти тесты могут быть разбиты на 10 групп по 10 тестов для параллельного выполнения.

`ya make -tt --split-factor=5`

Эта команда указывает системе тестирования разбить тесты на части таким образом, чтобы каждая часть могла быть исполнена в 5 параллельных потоков или “чанков”, что может привести к ускорению процесса тестирования за счет параллелизма.

* Опция `--test-prepare` предлагает  механизм для подготовки всего необходимого окружения для проведения тестов без их непосредственного запуска. Эта функциональность особенно полезна в контекстах, где требуется предварительная настройка тестового окружения, включая установку зависимостей, конфигурацию данных и создание вспомогательных сервисов, которые могут быть необходимы для успешного выполнения тестов.

Разработчики могут использовать эту опцию для конфигурации локального тестового окружения перед запуском тестов вручную.

После запуска команды `ya make -A --test-prepare` в директории с тестом будет лежать тестовый бинарный файл.
При обычных запусках, этот бинарный файл запускает тестовое окружение, в которое передается нужные параметры и путь до контекстного файла. 

Использование `--test-prepare` разделяет процесс подготовки тестов и их исполнение, что приводит к повышению управляемости тестового процесса.

* Опция `--no-src-changes` устанавливает директиву системе сборки не производить никаких изменений в исходных файлах проекта, гарантируя, что код и структура проекта останутся неизменными после выполнения операции. 

При выполнении тестов некоторые инструменты могут требовать временных изменений в коде или конфигурациях.
Опция `--no-src-changes` гарантирует, что все инструментальные изменения будут проведены с согласия разработчика и позволяет избежать неожиданных последствий в результате автоматизированных операций с кодом.

## Фильтрация
* Опция `-X` или `--last-failed-tests` позволяет автоматически запустить только те тесты, которые были неудачными (то есть “упали” или “провалились”) при последнем выполнении. Эта возможность значительно упрощает процесс исправления ошибок для разработчиков, позволяя быстро перепроверять решения проблем, не тратя время на повторный запуск уже пройденных успешно тестов.

Когда тесты запускаются с использованием данной опции, система тестирования ищет в своей истории о тестах, которые не прошли в последний раз. Затем, из большого пула тестов, выбираются только те, что были помечены как неудачные, и выполняются снова.

Указание дополнительных фильтров (например с помощью -F) расширяет множество тестов, которое будет запущено. Обычно это требуется, когда вы хотите следить за корректным статусом некоторых тестов, помимо перезапуска упавших от предыдущего прогона.

* Опция `-F=TESTS_FILTERS` или `--test-filter=TESTS_FILTERS` используется для тонкой фильтрации и выборочного запуска тестов в рамках большого тестового набора. Позволяет запускать только определённое подмножество тестов, которые соответствуют конкретным критериям.

Фильтры для тестов задаются в виде строк с использованием [специальных символов и паттернов](https://docs.python.org/3/library/fnmatch.html), таких как астериск (`*`) для обозначения любого количества символов и скобок (`[]`) для указания части имени теста или группы тестов. 

Астериск (`*`) служит шаблоном соответствия любому количеству символов в имени теста. Это позволяет выборочно запускать тесты, имена которых начинаются, заканчиваются или содержат определённые фрагменты.

Примеры: 
 - `-F=*DataTest` запустит все тесты, имена которых завершаются на `DataTest`.
 - `-F=Auth*` запустит все тесты, имена которых начинаются с `Auth`.
 - `-F=*Util*` запустит все тесты, содержащие `Util` в любом месте имени.
Шаблоны взяты в одинарные кавычки для того чтобы shell не развернул фильтр в список файлов, которому может соответствовать шаблон.

Использование скобок (`[]`)

Скобки (`[]`) используются для указания конкретных частей имени теста, которые должны быть соответствующим образом фильтрованы. Это может быть полезно для более точечного указания тестов по их порядковым номерам в рамках определённых групп или для реализации других механизмов выборки.

 Пример:
`-F="[X/Y] chunk"`, `--test-filter="[X/Y] chunk"` — фильтрация тестов по chunk'ам. Внутри `[]` можно использовать `*` для фильтрации.

Применение дать возможность разработчикам или тестировщикам эффективно управлять исполнением только тех тестов, которые актуальны для текущей задачи или для заданного контекста разработки.

* Опции `--style` и `--regular-tests` предоставляют возможность гибко управлять запуском тестов в процессе разработки программного обеспечения, фильтруя тесты на основе их типа: либо тесты стиля кода, либо обычные пользовательские тесты.

 `--style` Запуск тестов стиля кода

Опция `--style` используется для запуска тестов, направленных на проверку соответствия кода установленным стандартам и правилам оформления (стиль, линтинг). Это включает в себя автоматическую проверку форматирования кода, правильности использования синтаксиса и прочих аспектов стиля кодирования. 

При этом, с помощью флага `--strip-skipped-test-deps`, также происходит исключение зависимостей для пропущенных тестов, что оптимизирует процесс выполнения проверки стиля.

Поддерживаемые тесты стиля:
 - `classpath.clash`, `clang_tidy`, `eslint`, `gofmt`, `govet`, `java.style`, `ktlint`, `py2_flake8`, `flake8`, `black`, `ruff` Это инструменты для различных языков программирования (Java, C\+\+, JavaScript, Go, Kotlin, Python и т.д.), каждый из которых предназначен для автоматической проверки соответствия кода заранее определённым стилистическим стандартам и правилам.

`--regular-tests` Запуск пользовательских тестов

В противоположность опции `--style`, флаг `--regular-tests` позволяет запустить только те тесты, которые непосредственно проверяют функционал программного продукта, не затрагивая стилевые проверки. 

Поддерживаемые обычные тесты

`fuzz`, `g_benchmark`, `go_bench`, `go_test`, `gtest`, ` `java`, `jest`, `py2test`, `py3test`, `unittest` и [другие] (https://github.com/mtv2000/yatool/blob/newstyle/docs/ya_make_typetest.md) - представляют собой различные форматы и фреймворки тестирования для проверки функционала на многих языках программирования, включая С\+\+, Go, Java, Python, JavaScript и т.д.

* Опция `--test-size=TEST_SIZE_FILTERS` используется для запуска тестов, которые соответствуют определённым критериям размера. Эта возможность позволяет более точно контролировать объём и длительность тестирования путём выборочного запуска тестов на основе их классификации по размеру.

Размер тестов обычно определяется исходя из их сложности, времени выполнения и требуемых ресурсов:
 - **SMALL**: Тесты, требующие минимум времени и ресурсов для выполнения. Это обычно unit-тесты, которые проверяют функциональность в изоляции от внешних зависимостей.
 - **MEDIUM**: Тесты, занимающие больше времени и ресурсов, чем small-тесты, и могут включать в себя интеграционные тесты, тестирующие взаимодействие между различными частями системы.
 - **LARGE**: Самые затратные по времени и ресурсам тесты, включая системные, функциональные и E2E-тесты, охватывающие множество компонентов или всю систему в целом.

Используя `--test-size=TEST_SIZE_FILTERS`, можно указать, какие именно тесты следует выполнить. Например, параметр может использоваться для запуска только small-тестов в ранних этапах разработки для быстрой проверки изменений, или для выборочного запуска large-тестов перед релизом продукта.

* Опция `--test-type=TEST_TYPE_FILTERS` предназначена для выполнения фильтрации и выборочного запуска тестов в зависимости от их типа. Эта возможность  полезна в сценариях, когда требуется сосредоточить внимание на конкретном аспекте тестирования, например, при необходимости провести только функциональные тесты или только тесты производительности, не затрагивая другие виды тестов. 

Типом теста называется выполнение проверок с использованием одного конкретного инструмента, например, фреймворка pytest для Python или утилиты проверки форматирования кода go fmt для Golang. Полный список типов тестов приведен в [таблице](https://github.com/mtv2000/yatool/blob/newstyle/docs/ya_make_typetest.md)

* Опция `--test-tag=TEST_TAGS_FILTER` предоставляет возможность запускать конкретные тесты, отмеченные определёнными тегами. 

Теги  используются для категоризации и объединения тестов по различным признакам или характеристикам.

--test-tag=TEST_TAGS_FILTER — запускать только сюиты с определёнными тегами. 

Предположим, что в проекте имеются тесты, относящиеся к разработке новой функциональности и отмеченные тегом `feature/new-ui`. Если разработка этой функциональности идёт активно, и требуется часто запускать именно эти тесты, то команда может выглядеть следующим образом: `ya make -A --test-tag=feature/new-ui`
Такая команда запустит только те тесты, которые отмечены тегом `feature/new-ui`, позволяя сосредоточиться именно на текущей задаче.
Перед именами тегов можно использовать `+` для включения тега в фильтр и `-` для исключения. Таким образом `--test-tag tag1+tag2-tag3` запустит все тесты, у которых есть `tag1`, `tag2` и нет `tag3`. Фильтр `--test-tag -tag3` запустит все тесты без тега tag3. Фильтр `--test-tag ya:anytag` запустит все тесты со всеми тегами.

* Опция `--test-filename=TEST_FILES_FILTER` предоставляет возможность фильтрации и запуска тестов на основе имён файлов, содержащих тестовые сценарии.

Параметр актуален только для тестовых фреймворков, таких как `pytest` и `hermione`, которые поддерживают управление выполнением тестов на уровне отдельных файлов, другие тестовые фреймоврки не предоставляют такой информации.

При использовании `--test-filename=TEST_FILES_FILTER`, система тестирования будет искать тесты только среди тех, что расположены в файлах, имена которых соответствуют переданному шаблону, значительно сокращает объём тестов, подлежащих выполнению, и позволяет сфокусироваться на конкретной части кодовой базы или функциональности.

Примеры использования:
Отбор и запуск тестов, находящихся в файлах с определённым префиксом или постфиксом наименования: `ya make -A --test-filename=prefix_.py` 
Запуск тестов из конкретного набора файлов, имена которых точно указаны: `ya make -A --test-filename=test_module1.py`

* Опция `--test-size-timeout=TEST_SIZE_TIMEOUTS` предназначена для настройки продолжительности тайм-аутов для различных категорий тестов в зависимости от их размера.
Тесты классифицируются на несколько категорий (“small”, “medium”, “large”) на основе их ожидаемой продолжительности выполнения и ресурсных требований.
По умолчанию, тайм-аут теста для каждого размера в секундах (small=60, medium=600, large=3600)

Опция `--test-size-timeout` позволяет явно указать максимально допустимое время выполнения для каждой из этих категорий.

Формат значения `TEST_SIZE_TIMEOUTS`  следует шаблону `small=SECONDS, medium=SECONDS, large=SECONDS`, где `SECONDS` задаёт максимально допустимое время выполнения в секундах для тестов соответствующего размера.

Этот пример `–test-size-timeout=small=30,medium=300,large=1800` устанавливает тайм-ауты в 30 секунд для small-тестов, в 300 секунд для medium-тестов и в 1800 секунд для large-тестов.
## Отчет в консоли
* Опция `-P` или `--show-passed-tests` предназначена для вывода детальной информации о тестах, которые были успешно пройдены во время текущего запуска тестового набора. 

В стандартном режиме выполнения тестов сконцентрировано на сообщениях о неудачных тестах, поскольку именно они требуют внимания разработчиков для диагностики и исправления обнаруженных проблем. 

Успешно пройденные тесты часто остаются без дополнительного внимания, и результаты их выполнения выводятся в общем виде, например, в виде общего количества пройденных тестов.

Запуск тестов с отображением результата каждого пройденного теста может выглядеть так:
`ya make -A -P` или `ya make -A --show-passed-tests`

* Опция `--inline-diff`влияет на форматирование и представление различий (diff) между ожидаемыми и фактическими результатами, которые возникают при неудачном прохождении теста.

Включение `--inline-diff` обеспечивает более детальное и удобочитаемое отображение этих различий прямо в выводе в терминале, предоставляя построчное сравнение с подсветкой конкретных изменений или различий.

* Опция `--show-metrics` предназначена для отображения метрик тестирования в консоли в процессе выполнения тестов. 

Метрики тестирования могут включать в себя различную информацию, такую как время выполнения теста, использование памяти, количество запросов к базе данных, производительность API и другие значимые данные, которые помогают оценить не только корректность работы программного обеспечения, но и его эффективность.

При использовании этой опции, после завершения каждого теста или группы тестов, в выводе в консоль будут показаны собранные метрики для них. 

Чтобы увидеть метрики для успешно пройденных тестов, необходимо также использовать опцию `-P` (`--show-passed-tests`). Это связано с тем, что по умолчанию  в консоль выводиться информацию только о проваленных тестах, ограничивая вывод для успешных тестов общим итогом их количества. 

Опция `-P` показывает детальную информацию о каждом выполненном тесте, включая успешно пройденные, и, соответственно, когда используется вместе с `--show-metrics`, позволяет видеть собранные метрики и для успешных тестов.

`ya make -A -P --show-metrics` -  при выполнении каждого теста в консоль выводились детали по пройденным и не пройденным тестам, а также метрики, связанные с каждым из этих тестов.

* Опция `--disable-flake8-migrations` является настройкой, используемой в контексте тестирования и проверки кода с помощью утилиты `flake8`.

Все python-файлы, используемые в сборке и тестах, подключаемые через `ya.make` в секциях `PY_SRCS` и `TEST_SRCS`, автоматически проверяются линтером `flake8`. 

Он помогает идентифицировать ошибки стиля, сложности кода и потенциальные баги, проверяя код на соответствие рекомендациям PEP 8 и другим общепринятым стандартам написания кода.

`flake8` предоставляет возможность исключения или временного отключения определённых проверок (линтов), которые могут быть не всегда релевантны или предпочтительны для конкретных проектов или стадий разработки. Функциональность “миграций `flake8`” (также известная как “включение или отключение проверок `flake8`”) позволяет поэтапно вводить или исключать различные проверки для облегчения процесса адаптации кодовой базы к строгим стандартам.

Опция `--disable-flake8-migrations` используется для явного указания инструмента `flake8` игнорировать все настройки миграций (`flake8` migrations), которые могли быть определены разработчиками или командой проекта для поэтапного введения или отключения конкретных правил проверки. Эта опция “включает все проверки `flake8`”, тем самым применяя полный набор доступных проверок стиля и качества кода без исключения. 

В процессе разработки или при подготовке кода к финальной проверке перед слиянием в основную ветку проекта, разработчик может использовать эту опцию для гарантии того, что весь код полностью соответствует стандартам и рекомендациям.

 `ya make -A --disable-flake8-migrations path/to/module.py` 

Эта команда выполнит `flake8` проверку для файла `module.py`, применив ко всему коду полный набор правил без учёта ранее заданных миграций.

* Опция `--disable-jstyle-migrations` предназначена для использования в среде разработки Java и управляет применением проверок стиля кода.

Цель данной опции — включение всех доступных проверок стиля для Java кода, игнорируя любые ранее заданные “миграции” или исключения. 
В контексте стилевых проверок “миграции” часто используются для поэтапного внедрения новых стандартов стиля кодирования или для временного отключения определённых правил в процессе рефакторинга или при внесении значительных изменений в кодовую базу.

Для включения всех стилевых проверок Java в процессе тестирования или проверки кода, разработчик может добавить эту опцию в командную строку используемого инструмента анализа кода или сборки, например: `ya make -A --disable-jstyle-migrations`

## Канонизация
Канонизация тестов - это процесс объединения и стандартизации различных версий тестовых случаев, чтобы устранить возможные дубликаты и противоречия. Она также включает в себя подтверждение того, что каждый тестовый случай соответствует установленным стандартам и правилам создания тестов. 

* Опция `-Z` или `--canonize-tests` предназначена для канонизации результатов выполнения тестов.

Канонизация позволяет зафиксировать текущие результаты выполнения теста в качестве правильных (эталонных), с которыми в дальнейшем будет сравниваться вывод теста при его повторных запусках.

Тесты описываются в ya.make файлах в макросе `RUN`, где можно указать путь до файла с эталонными данными с помощью `CANONIZE_LOCALLY`:
```
OWNER(g:some-group)

EXECTEST() # Объявляем Exec-тест

RUN( # Команда, которую хотим выполнить
    cat input.txt
CANONIZE_LOCALLY ${TEST_CASE_ROOT}/test.out # Путь до файла с эталонными данными (будет сохранен в подкаталог canondata)
CANONIZE_DIR_LOCALLY ${TEST_CASE_ROOT}/dir # Путь до директории с эталонными данными (будет сохранен в подкаталог canondata)
)

DATA( # Тестовые данные (здесь лежит input.txt)
    path/devtools/ya/test/tests/exectest/data
)

# Текущий каталог для теста (каталог с input.txt)
TEST_CWD(path/devtools/ya/test/tests/exectest/data)

END()
```
В режиме ` -Z (--canonize-tests)` вместо сравнения данных с эталонными, сами эталонные данные будут заменены.  В локальное рабочее пространство будут внесены все необходимые изменения.

* Опция `--canon-diff=TEST_DIFF` используется для того, чтобы сравнить канонические данные тестов между различными состояниями кодовой базы. Это позволяет разработчикам и тестировщикам увидеть, как изменения в коде повлияли на результаты тестов, и помогает выявить регрессии или непреднамеренные эффекты от внесенных изменений.

Возможные значения для `TEST_DIFF` включают `rev1:rev2`, `HEAD`, и `PREV.
 * `--canon-diff=rev1:rev2`: Сравнить канонические данные между ревизиями `rev1` и `rev2`.
 * `--canon-diff=HEAD`: Сравнить текущие канонические данные с данными последней ревизии в текущей ветке.
 * `--canon-diff=PREV`: Сравнить канонические данные текущего состояния с данными состояния перед последним коммитом.

Для того, чтобы посмотреть, как менялся канонический результат теста, нужно прогнать конкретный тест в режиме `--canon-diff` командой `ya make -t --canon-diff PREV`.

Можно передать имя теста через параметр `-F(--test-filter)`, для этого можно сначала вывести список тестов в текущей папке `path/ya make -t --canon-diff HEAD -L`

* Опция `--canonize-via-http` предназначена для использования в процессе канонизации тестов, когда необходимо загрузить большие объемы канонических данных. Опция указывает системе, что для загрузки этих данных следует использовать протокол HTTP.

## Отладка
* Опция `--pdb` используется в контексте выполнения тестов, написанных на Python, и предназначена для автоматического запуска отладчика Python (pdb - Python Debugger) в случае возникновения ошибок во время выполнения теста.

Это позволяет разработчикам немедленно перейти к отладке проблемы, не прерывая процесс тестирования.

Чтобы передать управление `pdb` в произвольном месте, можно написать в коде `import pdb; pdb.set_trace()`, для `Python 3` можно использовать более короткий вариант `breakpoint()`.

Для активации `pdb` при возникновении ошибок, добавьте `--pdb` к команде запуска: `ya make -ttt --pdb`

Если во время выполнения произойдет ошибка, выполнение тестов остановится, и вы автоматически войдете в интерактивную сессию `pdb`. В этой сессии можно будет использовать команды `pdb`, такие как `list` для просмотра кода, `where` для просмотра стека вызовов, `next` и `step` для шагов выполнения кода, и `print` для вывода значений переменных.

* Опция `--gdb` позволяет автоматически запустить Python-тесты в среде GNU Debugger (GDB), когда это необходимо.
При этом `GDB` получит управление перед запуском тестов, а `pdb` только при срабатывании проверки.

Пример использования `ya make -ttt --gdb`

* Опция `--dlv` используется для запуска тестов для языка программирования Go и позволяет автоматически запустить тесты в отладчике `Delve` (dlv).

`Delve` является отладчиком для Go программ, предоставляющим возможности для пошагового выполнения кода, просмотра состояния переменных, управления точками останова и других действий, необходимых для детального анализа выполнения программы и поиска ошибок.

* Опция `--test-debug` предназначена для использования в процессе тестирования программного обеспечения, обеспечивая разработчикам расширенные возможности для отладки тестов. Эта опция включает ряд параметров, оптимизирующих процесс запуска тестов для удобства отладки, и предоставляет дополнительную информацию, полезную при диагностике проблем.

При использовании опции `--test-debug`, система тестирования автоматически применяет несколько дополнительных параметров к процессу выполнения тестов:

 1. **–test-threads=1**: Устанавливает количество потоков (threads) для выполнения тестов равным 1. Это означает, что все тесты будут выполняться последовательно, один за другим. Последовательное выполнение упрощает процесс отладки, поскольку исключает возможные проблемы, связанные с параллельным выполнением тестов, такие как состояние гонки (race condition).
 2. **–test-disable-timeout**: Отключает тайм-ауты для тестов. Это позволяет избежать автоматического прерывания теста по истечении времени выполнения, что важно при отладке, когда разработчику может потребоваться больше времени для анализа состояния программы или выполнения дополнительных действий в отладчике.
 3. **–retest**: Принудительно повторно выполняет все тесты, даже если они не были изменены. Это гарантирует, что при каждом использовании `--test-debug` тесты будут запущены, независимо от результатов предыдущих запусков.
 4. **–test-stderr**: Перенаправляет стандартный поток ошибок (stderr) тестов в стандартный вывод (stdout) или делает его видимым в выводе тестов. Это обеспечивает, что все сообщения об ошибках, предупреждения и другая диагностическая информация, выводимая тестами, будут непосредственно доступны для анализа.

Помимо вышеупомянутых настроек, опция `--test-debug` также печатает идентификатор процесса (PID) каждого запущенного теста. Эта информация может быть полезна для прикрепления отладчика к конкретному процессу теста для детального анализа его выполнения в реальном времени.

* Опция `--dlv-args=DLV_ARGS` предназначена для использования в контексте запуска Go юнит-тестов в отладчике `Delve` (dlv) и позволяет передать дополнительные аргументы командной строки непосредственно в `Delve`.

Когда вы используете `--dlv` для запуска тестов в `Delve`, `--dlv-args=DLV_ARGS` позволяет уточнить поведение `Delve`, добавив специфические для отладчика параметры. Это может включать в себя настройки логирования, управления сессией отладки, опции для точек останова и другие возможности `Delve`, которые могут быть полезны для конкретной задачи отладки.

* Опция `--test-retries=TESTS_RETRIES` предоставляет возможность автоматически повторять выполнение тестов, которые завершились неудачно, указанное количество раз (по умолчанию: 1).

Эта функциональность чрезвычайно полезна в ситуациях, когда тесты могут иногда завершаться сбоем из-за нестабильных условий окружающей среды, временных проблем с сетью, ресурсами системы или другими внешними факторами, не связанными напрямую с логикой тестируемого программного обеспечения.

При запуске тестов с использованием этой опции, система тестирования выполнит все указанные тесты и отслеживает те из них, которые завершились неудачно. 

Если какой-либо тест не прошел успешно, система автоматически попытается повторить его выполнение. Количество повторений для каждого неудачного теста задается значением `TESTS_RETRIES`. Например, если указано `--test-retries=2`, то каждый тест, который не прошел, будет автоматически повторен до двух раз в дополнение к его первоначальному запуску.

Предположим, вы работаете над проектом и хотите автоматически повторять неудачные тесты до трех раз в случае их сбоя. Для этого вы можете использовать следующую команду: `ya make -A --test-retries=3`

Эта команда запустит тестовый набор и, в случае неудачи любого теста, попытается повторить его выполнение до трех раз. Если тест проходит успешно в одной из попыток, он считается пройденным и система переходит к следующему тесту.

* Опция `--test-stderr`  предназначена для того, чтобы выводить стандартный поток ошибок (stderr) тестов непосредственно в консоль в реальном времени. Это позволяет разработчикам и тестировщикам наблюдать за всеми сообщениями об ошибках, предупреждениями и другой важной диагностической информацией, генерируемой тестами, без необходимости ожидания завершения всего набора тестов или изучения лог-файлов после их выполнения.

`ya make -t --test-stderr` - команда активирует вывод stderr тестов в консоль, позволяя вам наблюдать за возможными сообщениями об ошибках в режиме реального времени.

* Опция `--test-stdout` позволяет выводить стандартный поток вывода (stdout) тестов непосредственно в консоль в реальном времени. Это дает возможность разработчикам и тестировщикам наблюдать за всеми сообщениями, логами и другой информацией, генерируемой тестами, сразу же во время их выполнения.

Когда тесты запускаются с использованием этой опции, система тестирования перенаправляет все, что тесты пишут в стандартный поток вывода (stdout), непосредственно в консоль или терминал, из которого были запущены тесты.

Допустим, вы работаете над проектом и хотите запустить тесты, при этом видеть результаты выполнения тестов (вывод тестов) в консоли в реальном времени. Использование опции `--test-stdout` может выглядеть так: `ya make -ttt --test-stdout`

Эта команда заставит тестовую систему выводить в консоль все сообщения из stdout каждого теста, позволяя вам отслеживать ход выполнения тестов и немедленно реагировать на возникающие проблемы или ошибки.

* Опция `--test-disable-timeout` позволяет отключить механизм тайм-аута для тестов.

Это означает, что тесты не будут автоматически прерваны системой тестирования, если они превышают определенное время выполнения. 

В обычных условиях, `ya make` имеет настройку тайм-аута, чтобы ограничить максимальное время выполнения каждого теста. Это предотвращает “зависание” тестов и обеспечивает более эффективное использование ресурсов тестовой среды. Тайм-аут может быть задан глобально для всего набора тестов или индивидуально для каждого теста.

При использовании опции `--test-disable-timeout`, механизм тайм-аута отключается, и тесты могут выполняться неограниченное время. 

Опция `--test-disable-timeout` предназначена для использования толтко в локальной среде разработки и не рекомендуется к использованию при распределенном выполнении тестов (`--dist`).

Также эта опция несовместима с опцией `--cache-tests`, которая предполагает кеширование результатов тестов для ускорения последующих запусков.
 
* Опция `--test-binary-args=TEST_BINARY_ARGS` обеспечивает возможность передачи произвольных аргументов командной строки непосредственно в исполняемый файл теста (тестовый бинарный файл). Это позволяет настраивать поведение тестов на более глубоком уровне, используя механизмы, предусмотренные в самом тестовом приложении.

При запуске тестов с использованием этой опции, указанные аргументы (`TEST_BINARY_ARGS`) будут переданы в исполняемый файл теста как аргументы командной строки. Тестовое приложение может затем обрабатывать эти аргументы согласно своей внутренней логике, позволяя влиять на различные аспекты его выполнения.

Предположим, что ваше тестовое приложение поддерживает аргумент командной строки `--config`, который позволяет указать путь к файлу конфигурации. Вы хотите запустить тесты с использованием конкретного конфигурационного файла. Для этого вы можете использовать следующую команду: `ya make -A --test-binary-args=“–config=/path/to/config/file”`

В этом примере, аргумент `--config=/path/to/config/file` будет передан непосредственно в исполняемый файл теста, позволяя тестам использовать указанный файл конфигурации.

* Опция `--dump-test-environment` позволяет получить детальный снимок содержимого корня сборки теста, организованного в формате дерева, и записать эту информацию в файл `run_test.log` перед фактическим выполнением обертки теста.

При запуске тестов с этой опцией, система тестирования автоматически генерирует представление файловой структуры корневого каталога сборки теста в виде дерева. Это представление включает в себя все файлы, директории и их вложенные элементы, доступные в момент запуска теста. Сгенерированная информация затем записывается в файл `run_test.log`, который можно использовать для последующего анализа.

Допустим, вы столкнулись с проблемой, когда тест неожиданно не проходит из-за отсутствия определенного файла конфигурации в среде выполнения. Чтобы диагностировать эту проблему, вы можете запустить тесты с опцией `--dump-test-environment`, чтобы получить полное представление о содержимом корня сборки.

После выполнения тестов вы можете открыть файл `run_test.log` и изучить структуру директорий и файлов, доступных во время тестирования. Это поможет вам определить, отсутствует ли необходимый файл конфигурации или возможно он расположен в неправильном месте.

* Опция `--no-random-ports` используется для запуска сетевых тестов, которым требуются конкретные порты для их выполнения.

Использование опции `--no-random-ports` позволяет явно указать системе тестирования использовать порты, заданные разработчиком. 

Это дает разработчикам контроль над сетевыми настройками тестовой среды и упрощает интеграцию тестов с определенными сетевыми условиями или конфигурациями.

* Опция `--disable-test-graceful-shutdown` используется для управления поведением тестового процесса в случае возникновения тайм-аута. Эта опция указывает системе тестирования, что в случае превышения заданного времени выполнения теста, тестовый процесс (узел теста) должен быть немедленно прекращен (“убит”) без попытки его “мягкой” остановки или корректного завершения.

Когда тест превышает заданное время выполнения (тайм-аут), система пытается корректно завершить тестовый процесс, давая ему возможность освободить занятые ресурсы, закрыть открытые соединения и корректно завершить работу. 

Это называется “мягким” завершением работы или “graceful shutdown”. Однако, в некоторых случаях, такое поведение может быть не предпочтительным или неэффективным, например, если процесс теста “завис” и не реагирует на попытки его корректного завершения.

Использование опции `--disable-test-graceful-shutdown` отключает механизм “мягкого” завершения работы тестового процесса. Вместо этого, в случае возникновения тайм-аута, система тестирования немедленно отправляет сигнал на принудительное завершение процесса, что обычно приводит к его мгновенному прекращению.

## Среда выполнения
* Опция `--test-param=TEST_PARAMS` предоставляет возможность передачи произвольных параметров непосредственно в тесты, передавая в них параметры из командной строки.

При использовании этой опции, вы можете передать один или несколько параметров в формате `name=val`, где `name` — это имя параметра, а `val` — его значение. Эти параметры будут доступны внутри тестов, позволяя изменять их поведение в зависимости от переданных значений.

Пример использования: `ya make -t --test-param db_endpoint=localhost:1234`

* Опция `--autocheck-mode` предназначена для запуска тестов в локальной среде с набором ограничений, характерных для среды autocheck.

Включение `--autocheck-mode` автоматически активирует несколько ключевых ограничений и настроек:

 1. **–private-ram-drive**: Создает изолированный RAM-диск для каждого теста, что позволяет избежать взаимного влияния тестов друг на друга из-за файловой системы и гарантирует, что файлы, созданные или измененные одним тестом, не будут видны или доступны другим тестам. Это способствует повышению изоляции и надежности тестов.

 2. **–private-net-ns**: Использует изолированное сетевое пространство имен для каждого теста, обеспечивая, таким образом, что сетевые операции, выполняемые в рамках одного теста, не влияют на другие тесты. Это особенно важно для тестов, которые предполагают взаимодействие с сетью или определенные сетевые настройки.

* Опция `--private-ram-drive`  создавает для каждого тестового узла частный RAM-диск. 

При активации этой опции система сборки автоматически создает виртуальный диск в оперативной памяти (RAM-диск) для каждого узла тестирования, который его запрашивает. Все операции чтения и записи в рамках теста производятся на этом RAM-диске. Поскольку оперативная память обеспечивает значительно более высокую скорость чтения и записи данных по сравнению с традиционными жесткими дисками или даже SSD, использование RAM-диска может существенно сократить время, необходимое для выполнения операций ввода-вывода, и, как следствие, ускорить выполнение тестов.

* Опция `--private-net-ns` предназначена для создания изолированного сетевого пространства имен (network namespace) для каждого запускаемого теста.

Особенностью создаваемого сетевого пространства имен является поддержка `localhost`, что позволяет тестам взаимодействовать с сервисами, запущенными на локальной машине, но при этом изолировать их сетевые взаимодействия друг от друга.

## Расчет UID теста

* Опция `--cache-tests` позволяет сохранять результаты успешно выполненных тестов в кеше и при последующих запусках тестов избегать повторного выполнения тех, результаты которых уже присутствуют в кеше и считаются актуальными.

Когда эта опция активирована, система тестирования выполняет следующие действия:

 1. **Проверка Кеша**: Перед выполнением теста система проверяет наличие его результатов в кеше.
 2. **Пропуск Тестов**: Если результаты теста уже присутствуют в кеше и считаются валидными (то есть код, связанный с тестом, не был изменен с момента последнего успешного выполнения), тест пропускается.
 3. **Выполнение и Кеширование**: Тесты, для которых в кеше нет актуальных результатов, выполняются, а их результаты после успешного завершения сохраняются в кеше для использования в будущих запусках.

Все style-тесты по умолчанию кешируются, что эквивалентно команде `ya make - ttt --style --cache-tests`. 
Это значит, что при перезапуске `ya make` без изменения исходного кода style-тесты не будут перезапускаться, а вернут результат из кеша. Это сделано для ускорения локального прогона style-тестов, которые являются быстрыми и стабильными. Для принудительного перезапуска тестов нужно добавить ключ `--retest`.

* Опция `--retest` предназначена для принудительного повторного выполнения всех тестов, игнорируя любые результаты, которые могли быть сохранены в кеше от предыдущих запусков. Это значит, что независимо от того, был ли тест успешно выполнен ранее и его результат сохранен в кеше, при использовании этой опции система тестирования выполнит тест заново.

Когда тесты запускаются с использованием опции `--retest`, механизм кеширования результатов тестов игнорируется. Система тестирования будет вести себя так, как если бы она запускалась в первый раз, без доступа к предыдущим результатам. Все тесты в наборе запускаются заново, и их результаты обновляются в соответствии с текущим состоянием кодовой базы и тестовой среды.

## Зависимости тестов

* Опция `-b` или `--build-all`  указывает системе сборки собрать все цели, которые могут быть достигнуты через директивы `RECURSE` в `ya.make` файле, даже если эти цели не требуются непосредственно для запуска текущих тестов.

При вызове системы сборки с опцией `-b` или `--build-all`, система анализирует `ya.make` файлы на предмет директив `RECURSE`, прослеживая все возможные пути сборки до каждого компонента проекта.

Это включает в себя все библиотеки, программы, тесты и прочие цели, которые можно собрать. В результате, процесс сборки охватывает весь проект в полном объеме, не ограничиваясь только требуемыми для тестирования компонентами.

Предположим, у вас есть проект со множеством модулей, и вы хотите убедиться, что недавно внесенные изменения не поломали сборку других не связанных напрямую с тестами компонентов. Вызывая команду: `ya make -t -b` вы инициируете полную сборку проекта, что позволит обнаружить и предотвратить возможные проблемы. 

* Опция `--build-only-test-deps`  позволяет оптимизировать процесс сборки, фокусируясь исключительно на тех компонентах системы, которые необходимы для выполнения заданных тестов. 

При запуске системы сборки с этой опцией, механизм сборки проанализирует зависимости тестов, которые были запрошены для выполнения. Включение только необходимых для тестов зависимостей позволяет исключить из сборочного процесса все лишнее, что не имеет отношения к текущему тестовому прогону.

Вместо того, чтобы следовать всем путям в директивах `RECURSE` и собирать весь проект полностью, система сборки сфокусирована только на той части проекта, которая действительно используется в тестах.

Предположим, разработчик внес изменения в модуль и хочет запустить только тесты, относящиеся к этому модулю, не собирая остальную часть проекта. В этом случае команда для сборки и тестирования будет выглядеть так:

 `ya make -t --build-only-test-deps path_to_tests`

Здесь `path_to_tests` – это идентификатор или путь к тестам, которые необходимо выполнить. Система сборки выполнит анализ, определит, какие компоненты проекта требуются для выполнения данного набора тестов, и соберет только их.

* Опция `--strip-skipped-test-deps` позволяет исключить из процесса сборки зависимости тех тестов, которые по тем или иным причинам будут пропущены. 

Это означает, что система сборки не будет тратить время и ресурсы на подготовку тестов и их зависимостей, которые итак не будут выполнены.

* Опция `--strip-idle-build-results` позволяет системе сборки удалить результаты сборки, которые в конечном итоге не используются непосредственно для запуска тестов. 

Когда вы запускаете систему сборки с включенной опцией `--strip-idle-build-results`, в процессе сборки система отслеживает, какие именно результата сборки требуются для успешного выполнения заданных тестов. По завершении процесса сборки, вся информация о “лишних” узлах, которые не связаны с запуском тестов — удаляется.

* Опция `--no-strip-idle-build-results` указывает сохранить все результаты сборки, включая те, которые не нужны для прямого запуска тестов. Эта опция является противоположностью к `--strip-idle-build-results`, о которой шла речь ранее.

Применяется при полной сборке проекта (включая все модули и тесты) для проведения комплексной проверки перед релизом. В этом случае команда сборки может быть запущена с опцией `--no-strip-idle-build-results`, что гарантирует сохранение всех результатов сборки.

Синтаксис: `ya make -A --no-strip-idle-build-results`
